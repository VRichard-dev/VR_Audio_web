<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Admin – VR_Audio</title>
  <style>
    /* Egyszerű stílusok, nem részletezem */
  </style>
</head>
<body>
  <header>VR_Audio Admin Felület</header>
  <main>
    <div id="login-container">
      <h2>Bejelentkezés vagy Regisztráció</h2>
      <button id="login-btn">Belépés</button>
      <button id="logout-btn" style="display:none;">Kijelentkezés</button>
    </div>
  </main>

  <!-- Auth0 JS SDK -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.19/auth0-spa-js.production.js"></script>

  <script>
    let auth0 = null;

    // Auth0 beállítások, cseréld ki a saját domain-edre és client ID-dre
    const config = {
      domain: "dev-1k4duchefaqtjltq.eu.auth0.com",
      clientId: "kzHrHB7oC6GG8WEnIlRJTLMGNsNfC0qW",
      redirectUri: window.location.origin + "/admin/"
    };

    // Auth0 kliens inicializálása
    const configureClient = async () => {
      auth0 = await createAuth0Client({
        domain: config.domain,
        client_id: config.clientId,
        redirect_uri: config.redirectUri,
        cacheLocation: 'localstorage',  // jobb hogy megjegyezze a session-t
      });
    };

    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');

    // Ellenőrizzük, van-e bejelentkezett user
    const updateUI = async () => {
      const isAuthenticated = await auth0.isAuthenticated();

      if (isAuthenticated) {
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
      } else {
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
      }
    };

    // Login gomb eseménykezelője
    loginBtn.addEventListener('click', async () => {
      await auth0.loginWithRedirect();
    });

    // Logout gomb eseménykezelője
    logoutBtn.addEventListener('click', () => {
      auth0.logout({
        returnTo: window.location.origin + '/admin/'
      });
    });

    // Fő inicializáció
    window.onload = async () => {
      await configureClient();

      // Ha a URL-ben van auth callback, feldolgozzuk az eredményt
      if (window.location.search.includes('code=') && window.location.search.includes('state=')) {
        try {
          await auth0.handleRedirectCallback();
          // Töröljük a query string-et az URL-ből
          window.history.replaceState({}, document.title, '/admin/');
        } catch (e) {
          console.error('Hiba az Auth0 callback feldolgozásánál', e);
        }
      }

      await updateUI();
    };
  </script>
</body>
</html>

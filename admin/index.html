<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Admin – VR_Audio</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; }
    #cms-root { display:none; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>

  <button id="login-btn">Bejelentkezés / Regisztráció</button>
  <button id="logout-btn" style="display:none;">Kijelentkezés</button>

  <!-- Netlify CMS konténer -->
  <div id="cms-root"></div>

  <!-- Auth0 JS SDK -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.19/auth0-spa-js.production.js"></script>

  <!-- Netlify CMS -->
  <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>

  <script>
    let auth0 = null;
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const cmsRoot = document.getElementById('cms-root');

    // Auth0 konfiguráció (cseréld ki a saját értékeidre!)
    const config = {
      domain: "dev-1k4duchefaqtjltq.eu.auth0.com",
      client_id: "kzHrHB7oC6GG8WEnIlRJTLMGNsNfC0qW",
      redirect_uri: window.location.origin + "/admin/"
    };

    async function configureClient() {
      auth0 = await createAuth0Client({
        domain: config.domain,
        client_id: config.client_id,
        redirect_uri: config.redirect_uri,
      });
    }

    async function updateUI() {
      const isAuthenticated = await auth0.isAuthenticated();

      if (isAuthenticated) {
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        cmsRoot.style.display = 'block'; // Megjeleníti a CMS-t
      } else {
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        cmsRoot.style.display = 'none';
      }
    }

    window.onload = async () => {
      await configureClient();

      // Login callback kezelése
      if (window.location.search.includes('code=') && window.location.search.includes('state=')) {
        await auth0.handleRedirectCallback();
        window.history.replaceState({}, document.title, "/admin/");
      }

      await updateUI();

      loginBtn.addEventListener('click', () => auth0.loginWithRedirect());
      logoutBtn.addEventListener('click', () => auth0.logout({ returnTo: window.location.origin + "/admin/" }));
    };
  </script>

</body>
</html>
